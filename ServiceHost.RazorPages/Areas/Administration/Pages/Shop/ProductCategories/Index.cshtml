@page
@model ServiceHost.RazorPages.Areas.Administration.Pages.Shop.ProductCategories.IndexModel

@{
    ViewData["title"] = "مدیریت گروه محصولات";
}

<div class="row">
    <div class="col-sm-12">
        <h4 class="page-title pull-right">@ViewData["title"]</h4>
        <p class="pull-left">
            <a class="btn btn-success btn-lg" href="#showmodal=@Url.Page("./Index", "Create")">ایجاد گروه محصول جدید</a>
        </p>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">جستجو در گروه محصولات</h3>
            </div>
            <div class="panel-body">
                <form class="form-inline" role="form" method="get">
                    <div class="form-group">
                        <label class="sr-only" asp-for="SearchModel.Name"></label>
                        <input class="form-control" asp-for="SearchModel.Name" placeholder="نام گروه محصولی">
                    </div>
                    <button type="submit" class="btn btn-success waves-effect waves-light m-l-10">جستجو</button>
                    <a class="btn btn-primary waves-effect waves-light m-l-10" asp-page="./Index">مشاهده همه</a>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row" id="ProductCategoriesDiv">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">لیست گروه محصولات</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <table id="datatable" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>عکس</th>
                                    <th>نام</th>
                                    <th>تاریخ تولید</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.ProductCategories)
                                {
                                    <tr>
                                        <td>@item.Id</td>
                                        <td>
                                            <img src="~/ProductPictures/@item.Picture" style="width: 70px; height: 70px" />
                                        </td>
                                        <td>@item.Name</td>
                                        <td>@item.CreationDate</td>
                                        <td>
                                            <a class="btn btn-warning pull-right m-rl-5"
                                               href="#showmodal=@Url.Page("./Index", "Edit", new { id = item.Id})">
                                                <i class="fa fa-edit"></i> ویرایش
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/adminTheme/assets/datatables/jquery.dataTables.min.js"></script>
    <script src="~/adminTheme/assets/datatables/dataTables.bootstrap.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#datatable').dataTable();
        });
    </script>

    <script>

        var SinglePage = {};

        SinglePage.LoadModal = function () {
            var url = window.location.hash.toLowerCase();
            if (!url.startsWith("#showmodal")) {
                return;
            }
            url = url.split("showmodal=")[1];
            $.get(url,
                null,
                function (htmlPage) {
                    $("#ModalContent").html(htmlPage);
                    const container = document.getElementById("ModalContent");
                    const forms = container.getElementsByTagName("form");
                    const newForm = forms[forms.length - 1];
                    $.validator.unobtrusive.parse(newForm);
                    showModal();
                }).fail(function (error) {
                    alert("خطایی رخ داده، لطفا با مدیر سیستم تماس بگیرید.");
                });
        };

        function showModal() {
            $("#MainModal").modal("show");
        }

        function hideModal() {
            $("#MainModal").modal("hide");
        }

        $(document).on("submit",
            'form[data-ajax="true"]',
            function (e) {
                e.preventDefault();
                var form = $(this);
                const method = form.attr("method").toLocaleLowerCase();
                const url = form.attr("action");
                var action = form.attr("data-action");

                if (method === "get") {
                    const data = form.serializeArray();
                    $.get(url,
                        data,
                        function (data) {
                            CallBackHandler(data, action, form);
                        });
                } else {
                    var formData = new FormData(this);
                    $.ajax({
                        url: url,
                        type: "post",
                        data: formData,
                        enctype: "multipart/form-data",
                        dataType: "json",
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            CallBackHandler(data, action, form);
                        },
                        error: function (data) {
                            alert("خطایی رخ داده است. لطفا با مدیر سیستم تماس بگیرید.");
                        }
                    });
                }
                return false;
            });


        function CallBackHandler(data, action, form) {
            switch (action) {
                case "Message":
                    alert(data.Message);
                    break;
                case "Refresh":
                    if (data.isSuccedded) {
                        window.location.reload();
                    } else {
                        alert(data.message);
                    }
                    break;
                case "RefereshList":
                    {
                        hideModal();
                        const refereshUrl = form.attr("data-refereshurl");
                        const refereshDiv = form.attr("data-refereshdiv");
                        get(refereshUrl, refereshDiv);
                    }
                    break;
                case "setValue":
                    {
                        const element = form.data("element");
                        $(`#${element}`).html(data);
                    }
                    break;
                default:
            }
        }

    </script>

}